/*! greenboard 2025-11-26 */
angular.module("app.aireport",[]).controller("AIReportCtrl",["$scope","$rootScope","QueryService",function(r,e,n){r.showModal=!1,r.loading=!1,r.report=null,r.error=null,r.version=null,r.component=null,e.$on("openAIReport",function(e,t){r.version=t.version,r.component=t.component,r.showModal=!0,r.loading=!0,r.report=null,r.error=null,n.getReport(t.version,t.component).then(function(e){r.loading=!1,e?r.report=e:r.error="Report not generated yet"}).catch(function(e){r.loading=!1,r.error="Failed to load report: "+(e.data&&e.data.error?e.data.error:"Unknown error")})}),r.closeModal=function(){r.showModal=!1,r.report=null,r.error=null},r.$on("$destroy",function(){$(document).off("keydown.aireport")}),r.$watch("showModal",function(e){e?$(document).on("keydown.aireport",function(e){27===e.keyCode&&r.$apply(function(){r.closeModal()})}):$(document).off("keydown.aireport")})}]).directive("aiReportModal",function(){return{restrict:"E",controller:"AIReportCtrl",templateUrl:"partials/ai_report_modal.html"}});var app=angular.module("greenBoard",["ngSanitize","ngAnimate","ui.router","svc.data","svc.query","svc.timeline","app.main","app.target","app.sidebar","app.infobar","app.compare","app.darkmode","app.aireport"]);function getPercOfVal(e,t,r){var n;return!e||(n=e.passed+e.failed,r&&(n+=e.skipped),0==n)?0:(t/n*100).toFixed(1)}function getPercOfValStr(e,t,r){return wrapPercStr(getPercOfVal(e,t,r))}function getItemPerc(e){var t;return!e||0==(e=(t=e.passed+e.failed+e.skipped)+e.pending)?0:(t/e*100).toFixed(1)}function getItemPercStr(e){if(0<=getItemPerc(e))return wrapPercStr(getItemPerc(e))}function wrapPercStr(e){return e+"%"}app.run(["$location","$rootScope","Data",function(t,e,r){function i(){var e=t.search();r.setUrlParams(e)}i(),e.$on("$stateChangeStart",function(e,t,r,n,a){i()})}]),app.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/server/8.1.0/latest"),e.state("target",{url:"/:target",abstract:!0,template:"<ui-view/>",resolve:{target:["$stateParams",function(e){return e.target}],targetVersions:["$stateParams","Data","QueryService",function(e,t,r){e=e.target;return t.getTargetVersions(e)||r.getVersions(e)}]}}).state("target.version",{url:"/:version",templateUrl:"view.html",controller:"NavCtrl",resolve:{version:["$stateParams","$state","$location","targetVersions","target",function(e,t,r,n,a){var i=e.version||"latest";return"latest"!=i&&-1!=n.indexOf(i)||(i=n[n.length-1]),e.version=i}],testsFilter:["$stateParams","$state","Data",function(e,t,r){return e.testsFilter=r.getBuildFilter(),e.testsFilter}],buildsFilter:["$stateParams","$state","Data",function(e,t,r){return e.buildsFilter=r.getBuildsFilter(),e.buildsFilter}]}}).state("target.version.builds",{templateUrl:"partials/timeline.html",controller:"TimelineCtrl",resolve:{versionBuilds:["$stateParams","QueryService","Data","target","version","testsFilter","buildsFilter",function(e,t,r,n,a,i,o){var s=r.getBuildFilter(),l=r.getBuildsFilter();return t.getBuilds(n,a,s,l).then(function(e){return r.setVersionBuilds(e),r.getVersionBuilds()})}]}}).state("target.version.builds.build",{url:"/:build",template:"<ui-view />",controller:["$state","build","Data",function(e,t,r){r.setBuild(t),e.go("target.version.builds.build.jobs")}],resolve:{build:["$stateParams","$state","versionBuilds","Data",function(e,t,r,n){var a;return"latest"==(e.build||"latest")&&0<r.length?(a=r[r.length-1].build,e.build=a.split("-")[1]):r.length<=0&&(n.setBuildsFilter(5),n.setBuildFilter(0),t.go("target.version.builds",{target:e.target,version:e.version})),e.build}]}}).state("target.version.builds.build.jobs",{templateUrl:"partials/jobs.html",controller:"JobsCtrl",resolve:{buildJobs:["$stateParams","QueryService","Data","target",function(e,t,r,n){r=r.getBuild();return t.getJobs(r,n)}]}}).state("compareBuilds",{templateUrl:"partials/comparer.html",controller:"comparer",resolve:{target:["$stateParams","Data",function(e,t){return e.target=e.target||t.getCurrentTarget(),e.target}],versions:["$stateParams","Data","QueryService","target",function(e,t,r,n){var a=t.getTargetVersions(n);return a||(a=r.getVersions(n),t.setTargetVersions(a)),a}],version1:["$stateParams","versions",function(e,t){return e.version1=e.version1||t[t.length-1],e.version1}],version2:["$stateParams","versions",function(e,t){return e.version2=e.version2||t[t.length-1],e.version2}],builds1:["$stateParams","QueryService","target","version1",function(e,t,r,n){return t.getBuilds(r,n,2e3,5).then(function(e){return e})}],builds2:["$stateParams","QueryService","target","version2","builds1",function(e,t,r,n,a){return e.version1==n?a:t.getBuilds(r,n,2e3,5).then(function(e){return e})}],build1:["$stateParams","builds1",function(e,t){return e.build1=e.build1||t[t.length-2].build,e.build1}],build2:["$stateParams","builds2",function(e,t){return e.build2=e.build2||t[t.length-1].build,e.build2}],build1details:["$stateParams","Data","QueryService","build1",function(e,t,r,n){return r.getBuildSummary(n)}],build2details:["$stateParams","Data","QueryService","build2",function(e,t,r,n){return r.getBuildSummary(n)}]}})}]),angular.module("app.compare",["googlechart","svc.query"]).controller("comparer",["$scope","$state","Data","QueryService","target","versions","version1","version2","builds1","builds2","build1","build2","build1details","build2details",function(i,e,t,r,n,a,o,s,l,u,c,d,p,f){r.getVersions(n).then(function(e){return e});function g(e,t,r,n,a){return{type:e,data:{cols:[{id:t,label:t,type:"string",p:{}},{id:"build1",label:i.compareVersion1+"-"+i.compareBuildId1,type:"number",p:{html:!0}},{id:"build2",label:i.compareVersion2+"-"+i.compareBuildId2,type:"number",p:{html:!0}}],rows:[]},options:{title:a,isStacked:"false",displayExactValues:!0,vAxis:{title:n,gridlines:{count:5}},hAxis:{title:r,slantedText:!0,slantedTextAngle:90,showTextEvery:1,textStyle:{fontSize:10}},bar:{groupWidth:"20%"},legend:{position:"top"},allowHtml:!0,tooltip:{isHtml:!0},width:"100%",height:500},formatters:{color:[{columnNum:1,formats:[{from:0,to:95,color:"red"},{from:95,to:101,color:"green"}]},{columnNum:2,formats:[{from:0,to:95,color:"red"},{from:95,to:101,color:"green"}]}]}}}n=n||"server",0==a.length&&(a=r.getVersions(n).then(function(e){return e})),o=o||a[a.length-1],s=s||a[a.length-1],0==l.length&&(l=r.getBuilds(n,o,2e3,5).then(function(e){return e})),0==u.length&&(u=r.getBuilds(n,s,2e3,5).then(function(e){return e})),c=c||l[l.length-1].build,d=d||u[u.length-1].build,p=p||r.getBuildSummary(c).then(function(e){return e}),f=f||r.getBuildSummary(d).then(function(e){return e}),i.changeCompareTarget=function(e){i.compareTarget=e},i.version1Change=function(e){i.compareVersion1=e},i.version2Change=function(e){i.compareVersion2=e},i.build1Change=function(e){i.compareBuildId1=e},i.build2Change=function(e){i.compareBuildId2=e},i.changeGraphType=function(e){i.graphType=e},i.changeOs=function(e){i.compareOS=e},i.$watch(function(){return i.compareTarget},function(e,t){e!==t&&r.getVersions(e).then(function(e){return i.compareVersion1=e[e.length-1],i.compareVersion2=e[e.length-1],i.versions=e})}),i.$watch(function(){return i.compareVersion1},function(e,t){e!==t&&r.getBuilds(i.compareTarget,e,2e3,5).then(function(e){var t=_.map(_.map(e,"build"),function(e){return e.split(["-"])[1]});return i.compareBuildId1=t[t.length-1],i.compareBuilds1=t,e})}),i.$watch(function(){return i.compareVersion2},function(e,t){e!==t&&r.getBuilds(i.compareTarget,e,2e3,5).then(function(e){var t=_.map(_.map(e,"build"),function(e){return e.split(["-"])[1]});return i.compareBuildId2=t[t.length-1],i.compareBuilds2=t,e})}),i.$watch(function(){return i.compareBuildId1},function(e,t){e!==t&&r.getBuildSummary(i.compareVersion1+"-"+e).then(function(e){return i.osRunPercChart=y(e.os,f.os,i.graphType,"OS","Run %","OS","Total run % per OS"),i.osPassPercChart=C(e.os,f.os,i.graphType,"OS","Pass %","OS","Pass % per OS"),i.componentsCharts=x(e.os,f.os),i.runPercChart=i.componentsCharts[i.compareOS].runPercChart,i.passPercChart=i.componentsCharts[i.compareOS].passPercChart,p=e})}),i.$watch(function(){return i.compareBuildId2},function(e,t){e!==t&&r.getBuildSummary(i.compareVersion2+"-"+e).then(function(e){return i.osRunPercChart=y(p.os,e.os,i.graphType,"OS","Run %","OS","Total run % per OS"),i.osPassPercChart=C(p.os,e.os,i.graphType,"OS","Pass %","OS","Pass % per OS"),i.componentsCharts=x(p.os,e.os),i.runPercChart=i.componentsCharts[i.compareOS].runPercChart,i.passPercChart=i.componentsCharts[i.compareOS].passPercChart,f=e})}),i.$watch(function(){return i.graphType},function(r,e){r!==e&&(i.osRunPercChart.type=r,i.osPassPercChart.type=r,i.runPercChart.type=r,i.passPercChart.type=r,_.forEach(i.componentsCharts,function(e,t){e.runPercChart.type=r,e.passPercChart.type=r}))}),i.$watch(function(){return i.compareOS},function(e,t){e!==t&&(i.runPercChart=i.componentsCharts[e].runPercChart,i.passPercChart=i.componentsCharts[e].passPercChart)});var m=function(e){if(_.isObject(e))return{runPerc:e.totalCount/(e.totalCount+e.pending)*100,totalCount:e.totalCount,pendingTests:e.pending}},b=function(e,t,r){if(_.isObject(e)&&_.isObject(t))return{c:[{v:r},{v:_.isNaN(e.runPerc)?0:e.runPerc,f:"Run %: "+(_.isNaN(e.runPerc)?0:e.runPerc)+"<br/>Total Test run: "+e.totalCount+"<br/>Pending tests: "+e.pendingTests},{v:_.isNaN(t.runPerc)?0:t.runPerc,f:"Run %: "+(_.isNaN(t.runPerc)?0:t.runPerc)+"<br/>Total Test run: "+t.totalCount+"<br/>Pending tests: "+t.pendingTests}]}},h=function(e){if(_.isObject(e))return{passPerc:(e.totalCount-e.failCount)/e.totalCount*100,passCount:e.totalCount-e.failCount,failCount:e.failCount}},v=function(e,t,r){if(_.isObject(e)&&_.isObject(t))return{c:[{v:r},{v:_.isNaN(e.passPerc)?0:e.passPerc,f:"Pass%: "+(_.isNaN(e.passPerc)?0:e.passPerc)+"<br/>Passed tests: "+e.passCount+"<br/>Failed tests: "+e.failCount},{v:_.isNaN(t.passPerc)?0:t.passPerc,f:"Pass%: "+(_.isNaN(t.passPerc)?0:t.passPerc)+"<br/>Passed tests: "+t.passCount+"<br/>Failed tests: "+t.failCount}]}};function y(e,t,r,n,a,i,o){var r=g(r,n,a,i,o),n=_.mapValues(_.omitBy(e,_.isNumber),m),s=_.mapValues(_.omitBy(t,_.isNumber),m);return r.data.rows=_.map(n,function(e,t){var r=_.get(s,t,{runPerc:0,totalCount:0,pendingTests:0});return b(e,r,t)}),r}function C(e,t,r,n,a,i,o){var r=g(r,n,a,i,o),n=_.mapValues(_.omitBy(e,_.isNumber),h),s=_.mapValues(_.omitBy(t,_.isNumber),h);return r.data.rows=_.map(n,function(e,t){var r=_.get(s,t,{passPerc:0,passCount:0,failCount:0});return v(e,r,t)}),r}function x(e,n){return _.mapValues(e,function(e,t){var r=_.get(n,t);return{runPercChart:y(e,r,i.graphType,"Component for "+t,"Run %","Component","Runs % per component for "+t),passPercChart:C(e,r,i.graphType,"Component for "+t,"Run %","Component","Pass % per component for "+t)}})}i.compareTargets=["server","mobile"],i.compareTarget=n,i.versions=a;o=c.split(["-"])[0],i.compareVersion1=i.versions[_.indexOf(i.versions,o)],s=d.split(["-"])[0],i.compareVersion2=i.versions[_.indexOf(i.versions,s)],i.compareBuildId1=c.split(["-"])[1],i.compareBuildId2=d.split(["-"])[1],n=_.map(_.map(l,"build"),function(e){return e.split(["-"])[1]}),a=_.map(_.map(u,"build"),function(e){return e.split(["-"])[1]});i.compareBuilds1=n,i.compareBuilds2=a,i.graphTypes=["BarChart","ColumnChart","LineChart","Table"],i.graphType="Table",i.osRunPercChart=y(p.os,f.os,i.graphType,"OS","Run %","OS","Total run % per OS"),i.osPassPercChart=C(p.os,f.os,i.graphType,"OS","Pass %","OS","Pass % per OS"),i.componentsCharts=x(p.os,f.os),i.compareOSs=_.keys(i.componentsCharts),i.compareOS="CENTOS",i.runPercChart=i.componentsCharts[i.compareOS].runPercChart,i.passPercChart=i.componentsCharts[i.compareOS].passPercChart}]),"undefined"!=typeof d3&&(d3.tip=function(){var s=function(){return"n"},l=function(){return[0,0]},u=function(){return" "},c=document.body,t=null,r=null,d=null,p=null;function f(){var e;return null==t&&((e=d3.select(document.createElement("div"))).style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box"),t=e.node(),c.appendChild(t)),d3.select(t)}function n(e){for(var t=p||e;null==t.getScreenCTM&&null!=t.parentNode;)t=t.parentNode;var e={},r=t.getScreenCTM(),n=t.getBBox(),a=n.width,i=n.height,o=n.y;return d.x=n.x,d.y=o,e.nw=d.matrixTransform(r),d.x+=a,e.ne=d.matrixTransform(r),d.y+=i,e.se=d.matrixTransform(r),d.x-=a,e.sw=d.matrixTransform(r),d.y-=i/2,e.w=d.matrixTransform(r),d.x+=a,e.e=d.matrixTransform(r),d.x-=a/2,d.y-=i/2,e.n=d.matrixTransform(r),d.y+=i,e.s=d.matrixTransform(r),e}function a(e){return"function"==typeof e?e:function(){return e}}var g={n:function(){var e=n(this);return{top:e.n.y-f().node().offsetHeight,left:e.n.x-f().node().offsetWidth/2}},s:function(){var e=n(this);return{top:e.s.y,left:e.s.x-f().node().offsetWidth/2}},e:function(){var e=n(this);return{top:e.e.y-f().node().offsetHeight/2,left:e.e.x}},w:function(){var e=n(this);return{top:e.w.y-f().node().offsetHeight/2,left:e.w.x-f().node().offsetWidth}},nw:function(){var e=n(this);return{top:e.nw.y-f().node().offsetHeight,left:e.nw.x-f().node().offsetWidth}},ne:function(){var e=n(this);return{top:e.ne.y-f().node().offsetHeight,left:e.ne.x}},sw:function(){var e=n(this);return{top:e.sw.y,left:e.sw.x-f().node().offsetWidth}},se:function(){var e=n(this);return{top:e.se.y,left:e.se.x}}};function m(e){(r=(e=(e=e).node())?"svg"===e.tagName.toLowerCase()?e:e.ownerSVGElement:null)&&(d=r.createSVGPoint(),c.appendChild(f().node()))}return m.show=function(){var e=Array.prototype.slice.call(arguments),t=this instanceof SVGElement?this:null,r=((t=0<e.length&&e[e.length-1]instanceof SVGElement?e.pop():t)&&(p=t),u.apply(t||this,e)),n=l.apply(t||this,e),e=s.apply(t||this,e),a=f(),i=document.documentElement.scrollTop||c.scrollTop,o=document.documentElement.scrollLeft||c.scrollLeft;return a.html(r).style("opacity",1).style("pointer-events","all"),["n","s","e","w","nw","ne","sw","se"].forEach(function(e){a.classed(e,!1)}),r=g[e].apply(t||this),a.classed(e,!0).style("top",r.top+n[0]+i+"px").style("left",r.left+n[1]+o+"px"),m},m.hide=function(){return f().style("opacity",0).style("pointer-events","none"),m},m.attr=function(e,t){return arguments.length<2&&"string"==typeof e?f().attr(e):(e=Array.prototype.slice.call(arguments),d3.selection.prototype.attr.apply(f(),e),m)},m.style=function(e,t){return arguments.length<2&&"string"==typeof e?f().style(e):(e=Array.prototype.slice.call(arguments),d3.selection.prototype.style.apply(f(),e),m)},m.direction=function(e){return arguments.length?(s=null==e?e:a(e),m):s},m.offset=function(e){return arguments.length?(l=null==e?e:a(e),m):l},m.html=function(e){return arguments.length?(u=null==e?e:a(e),m):u},m.rootElement=function(e){return arguments.length?(c=null==e?e:a(e),m):c},m.destroy=function(){return t&&(f().remove(),t=null),m},m}),angular.module("svc.timeline",[]).directive("viewTimeline",["Data","Timeline",function(i,o){return{restrict:"E",scope:{onChange:"=",builds:"="},link:function(r,e,t){var n=r.builds,a="#"+e.attr("id");o.init(n,a,r.onChange),r.$watch(function(){return i.getBuildFilter()},function(e,t){null!=t&&e!=t&&(n=i.getVersionBuilds(),o.update(n,a))}),r.$watch(function(){return i.getBuildFilter()},function(e,t){e!=t&&(n=i.getVersionBuilds(),o.update(n,a))}),r.$watch(function(){return i.getBuildsFilter()},function(e,t){e!=t&&(r.spin=!0,n=i.getVersionBuilds(),o.update(n,a),r.spin=!1)})}}}]).service("Timeline",["Data","$timeout",function(f,t){var g,m,b,h,v,y,C,r={top:40,right:10,bottom:100,left:70},x=800-r.left-r.right,P=300-r.top-r.bottom,B=["rgba(59, 201, 59, 0.7)","rgba(222, 0, 0, 0.7)"],T=["rgba(59, 201, 59, 1)","rgba(222, 0, 0, 1)"],S=["rgba(59, 201, 59, 1)","rgba(222, 0, 0, 1)"];function n(e){return d3.select(e).append("svg").attr("width",x+r.left+r.right).attr("height",P+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")")}function k(e,t,n,i){var a=d3.tip().attr("class","d3-tip d3-tip").offset([-10,0]).direction("n").html(function(t){var e,r,n,a;return t&&t.x&&(e=i.find(function(e){return e.build===t.x}))?(n=0<(r=e.Passed+e.Failed)?(e.Passed/r*100).toFixed(1):0,a=0<r?(e.Failed/r*100).toFixed(1):0,'<div style="text-align: left; min-width: 180px;"><div style="margin-bottom: 8px;"><strong style="font-size: 14px;">'+t.x+'</strong><br/><span style="font-size: 12px; opacity: 0.9;">Total: '+r.toLocaleString()+'</span></div><div style="display: flex; gap: 8px; margin-top: 8px;"><div class="d3-tip-pass" style="flex: 1; padding: 6px 10px; border-radius: 4px; background: rgba(59, 201, 59, 0.95); color: #ffffff; font-weight: 600; text-align: center;"><div style="font-size: 11px; margin-bottom: 2px;">Passed</div><div style="font-size: 13px;">'+e.Passed.toLocaleString()+'</div><div style="font-size: 10px; opacity: 0.9;">('+n+'%)</div></div><div class="d3-tip-fail" style="flex: 1; padding: 6px 10px; border-radius: 4px; background: rgba(222, 0, 0, 0.95); color: #ffffff; font-weight: 600; text-align: center;"><div style="font-size: 11px; margin-bottom: 2px;">Failed</div><div style="font-size: 13px;">'+e.Failed.toLocaleString()+'</div><div style="font-size: 10px; opacity: 0.9;">('+a+"%)</div></div></div></div>"):""});e.call(a),n.on("mouseover",function(e,t){var r=e.x;d3.select(this);n.filter(function(e){return e.x===r}).each(function(){var e=d3.select(this),t=parseFloat(e.attr("x"))+parseFloat(e.attr("width"))/2,r=parseFloat(e.attr("y"))+parseFloat(e.attr("height"))/2;e.transition().duration(150).attr("transform","translate("+t+","+r+") scale(1.05) translate("+-t+","+-r+")").style("opacity",1).style("filter","drop-shadow(0 0 6px rgba(0,0,0,0.3))")}),a.show(e,n[1][t])}),n.on("mouseout",function(e,t){var r=e.x;n.filter(function(e){return e.x===r}).each(function(){d3.select(this).transition().duration(150).attr("transform","scale(1)").style("opacity",.8).style("filter","none")}),a.hide()})}function a(e){var n,t,r,a,i,o,s,l,u,c,d,p;e&&0!==e.length&&(d=d3.layout.stack(),n=_.map(e,"build"),d=d(["Passed","Failed"].map(function(r){return e.map(function(e,t){return{x:n[t],y:e[r]||0}})})),p=d3.max(d,function(e){return d3.max(e,function(e){return e.y0+e.y})}),t=n,C=d3.scale.ordinal().domain(t).rangeRoundBands([0,x],.08),t=C,a=d3.svg.axis().scale(t).tickSize(0).tickPadding(6).orient("bottom"),t=t.domain(),1<(r=Math.floor(t.length/20))&&(t=t.filter(function(e,t){return t%r==0}),a.tickValues(t)),t=a,a=p,a=((e,t)=>{var e=d3.svg.axis().scale(e).tickSize(0).tickPadding(8).orient("left").tickSize(-x,0,0).tickFormat(function(e){return 1e3<=e?(e/1e3).toFixed(e%1e3==0?0:1)+"k":e}),r=d3.range(t);if(50<t){for(;10<=r.length;)r=r.filter(function(e,t){return t%10==0});5<r.length&&(r=r.filter(function(e,t){return t%2==0}))}else r=[t];return e.tickValues(r),e})(y=d3.scale.linear().domain([0,a]).range([P,0]),p),p=n,g=f.getBuild(),-1==p.indexOf(g)&&(g=p[p.length-1]),b.selectAll(".layer").remove(),b.selectAll(".hover-line").remove(),b.selectAll(".hover-circles").remove(),p=d,(c=(c=b).selectAll(".layer").data(p)).enter().append("g").attr("class","layer"),i=C,(p=(p=h=c).selectAll("rect").data(function(e){return e})).enter().append("rect").attr("x",function(e){return i(e.x)}).attr("y",P).attr("width",i.rangeBand()).attr("height",0).style("fill",function(e,t,r){return(e.x==g?T:B)[r]}).style("stroke",function(e,t,r){return e.x==g?S[r]:"rgba(255,255,255,0.4)"}).style("stroke-width",1.5).style("cursor","pointer").style("opacity",.85).attr("class","bar-segment").attr("rx",2).attr("ry",2),p.exit().transition().delay(100).attr("y",function(e){return y(e.y0)}).attr("height",0),o=y,(v=p).transition().delay(function(e,t){return 10*t}).duration(600).ease("cubic-out").attr("y",function(e){return o(e.y0+e.y)}).attr("height",function(e){return o(e.y0)-o(e.y0+e.y)}),k(b,0,v,e),l=m,u=d,(s=v).on("click",function(e,t){var n=e.x;if(u&&u[0])for(var r=0;r<u[0].length;r++)if(u[0][r].x===n){0;break}s.style("fill",function(e,t,r){return(e.x===n?T:B)[r]}).style("stroke",function(e,t,r){return e.x===n?S[r]:"rgba(255,255,255,0.4)"}),l(n)}),c=t,b.append("g").attr("class","x axis").attr("transform","translate(0,"+P+")").call(c).selectAll("text").style("text-anchor","end").style("font-size","13px").style("font-weight","600").style("fill","#444").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)"),p=a,(d=b).append("g").attr("class","y axis grid").attr("transform","translate(0,0)").call(p).selectAll("text").style("font-size","14px").style("font-weight","600").style("fill","#444"),d.append("g").attr("class","grid").attr("transform","translate(0,0)").call(p.tickSize(-x,0,0).tickFormat("")),g)&&v&&v.style("fill",function(e,t,r){return(e.x==g?T:B)[r]}).style("stroke",function(e,t,r){return e.x==g?S[r]:"rgba(255,255,255,0.3)"})}return{init:function(e,t,r){b=n(t),m=r,a(e)},update:function(e){v&&v.transition().delay(100).duration(200).attr("y",function(e){return y(e.y0)}).attr("height",0),b.selectAll(".tick text").transition().delay(10).style("fill","white"),t(function(){b.select(".x").remove(),b.select(".y").remove(),h&&h.remove(),a(e)},250)}}}]),angular.module("app.darkmode",[]).service("DarkMode",[function(){var t=!1,e=localStorage.getItem("greenboardDarkMode"),e=(null!==e&&(t="true"===e),{isDarkMode:function(){return t},toggle:function(){return t=!t,localStorage.setItem("greenboardDarkMode",t),this.apply(),t},apply:function(){var e=document.body;t?e.classList.add("dark-mode"):e.classList.remove("dark-mode")}});return e.apply(),e}]).directive("darkModeToggle",["DarkMode",function(n){return{restrict:"E",template:'<div class="theme-toggle-wrapper"><span class="theme-toggle-text">Try dark mode <span class="theme-toggle-arrows"><span>></span><span>></span><span>></span></span></span><div class="theme-toggle-container" ng-click="toggleDarkMode($event)" title="Toggle Dark Mode"><label class="theme-toggle-label" ng-class="{\'dark-active\': isDark}"><i class="fas fa-moon"></i><i class="fas fa-sun"></i><span class="theme-toggle-ball"></span></label></div></div>',link:function(t,e,r){t.isDark=n.isDarkMode(),n.apply(),t.toggleDarkMode=function(e){e&&(e.preventDefault(),e.stopPropagation()),t.isDark=n.toggle()}}}}]),angular.module("svc.data",[]).value("DEFAULT_FILTER_BY",2e3).value("DEFAULT_BUILDS_FILTER_BY",10).service("Data",["$location","DEFAULT_FILTER_BY","DEFAULT_BUILDS_FILTER_BY",function(o,t,r){function s(e,t,r){var n,a,i;_sideBarItems[e]=_sideBarItems[e].map(function(e){return e.key==t&&(e.disabled=r),e}),e=e,n=t,a=r,i=o.search()[e],a?i&&(a=new RegExp(",?"+n),i=i.replace(a,"").replace(/^,/,""),o.search(e,i=""==i?null:i)):(i&&0!=i.length?-1==i.indexOf(n)&&(i+=","+n):i=n,_.some(_.map(_sideBarItems[e],"disabled"))||(i=null),o.search(e,i))}function n(t,e){var r=_availableFilters[e];_buildJobsActive=_.reject(_buildJobsActive,function(e){return e[r]==t||e.variants&&e.variants[r]===t}),s(e,t,!0)}function a(n,a){var i=_availableFilters[a],e=_.filter(_buildJobs,function(t){if(t[i]==n||t.variants&&t.variants[i]===n){for(var e in _availableFilters)if(a!==e){var r=_availableFilters[e],e=_sideBarItems[e].find(function(e){return e.key===t[r]||t.variants&&t.variants[r]===e.key});if(e&&e.disabled)return!1}return!0}});_buildJobsActive=_buildJobsActive.concat(e),s(a,n,!1)}function i(){var e=_builds.filter(function(e){return e.Passed+e.Failed>_filterBy});return 0==(e=0==_filterBy?_builds.filter(function(e){return e.Passed+e.Failed<t}):e).length&&0!=_filterBy&&(e=_builds,_filterBy=0),e}function l(){var e=_build;return"latest"!=e&&""!=e||0<_builds.length&&(e=_builds[_builds.length-1]),e=e&&-1==e.indexOf("-")?_version+"-"+e:e}return _versions=[],_target="server",_version=null,_versions=[],_build=null,_builds=[],_targetVersions={},_buildJobs=[],_buildJobsActive=[],_sideBarItems={},_filterBy=t,_buildsFilterBy=r,_initUrlParams=null,_buildInfo={},_jobsPage=0,_jobsPerPage=20,_availableFilters={features:"component",platforms:"os",serverVersions:"server_version",dapiVersions:"dapi",nebulaVersions:"dni",envVersions:"env"},{setTarget:function(e){_target=e},setTargetVersions:function(e){_target&&(_targetVersions[_target]=e),_versions=e},setSelectedVersion:function(e){_version=e},setBuild:function(e){-1==e.indexOf("-")&&_version&&(e=_version+"-"+e),_build=e},setBuildInfo:function(e){_buildInfo=e},getBuildInfo:function(){return _buildInfo},setVersionBuilds:function(e){e.sort(function(e,t){return e.build<t.build?-1:t.build<e.build?1:0}),_builds=e},setBuildJobs:function(e){_buildJobs=e,_buildJobsActive=e},getBuildJobs:function(){return _buildJobs},getActiveJobs:function(){return _buildJobsActive},getCurrentTarget:function(){return _target},getTargetVersions:function(e){var t=_versions;return t=e?_targetVersions[e]:t},getSelectedVersion:function(){return _version},getBuild:l,getVersionBuilds:i,toggleItem:function(t,r,e){e?_.some(_.map(_sideBarItems[r],"disabled"))?n(t,r):(_.map(_sideBarItems[r],"key").forEach(function(e){e!=t&&n(e,r)}),s(r,t,!1)):a(t,r)},setSideBarItems:function(e){for(var t in _sideBarItems=e)_availableFilters[t]||(_availableFilters[t]=t);_.forEach(_availableFilters,function(e,t){_sideBarItems[t]||delete _availableFilters[t]}),_sideBarItems.buildVersion=l(),_initUrlParams&&_initUrlParams.target==_target&&(_.mapKeys(e,function(e,t){t in _initUrlParams&&e.forEach(function(e){n(e.key,t)})}),_.mapKeys(_initUrlParams,function(e,t){-1!=Object.keys(_availableFilters).indexOf(t)&&e.split(",").forEach(function(e){a(e,t)})})),_initUrlParams=null},getSideBarItems:function(){return _sideBarItems},getItemStats:function(t,e){var r=_availableFilters[e],n=_buildJobsActive,e=("build"!=e&&(n=_.filter(_buildJobsActive,function(e){return e[r]==t||!e[r]&&!e.variants||e.variants&&e.variants[r]==t})),n=_.reject(n,"olderBuild",!0),n=_.reject(n,"deleted",!0),_.sum(_.map(_.uniq(n),"totalCount"))),a=_.sum(_.map(_.uniq(n),"failCount")),i=_.sum(_.map(_.uniq(n),"pending")),n=_.sum(_.map(_.uniq(n),"skipCount")),a={passed:(e=e||0)-(a=a||0)-(n=n||0),failed:a,pending:i=i||0,skipped:n,total:e+i},n=getPercOfVal(a,a.passed,!1);return{absStats:a,percStats:{run:getItemPercStr(a),passed:wrapPercStr(n),failed:getPercOfValStr(a,a.failed,!1),pending:getPercOfValStr(a,a.pending,!0),skipped:getPercOfValStr(a,a.skipped,!0),passedRaw:n}}},toggleAllSidebarItems:function(t,r){_sideBarItems[t].forEach(function(e){r&&!e.disabled?n(e.key,t):e.disabled&&a(e.key,t)})},getBuildFilter:function(){return _filterBy},setBuildFilter:function(e){_filterBy=e=void 0===e?t:e},getBuildsFilter:function(){return _buildsFilterBy},setBuildsFilter:function(e){_buildsFilterBy=e=void 0===e?r:e},getLatestVersionBuild:function(){var e=i();return 0<e.length?e[e.length-1].build:_build},setUrlParams:function(e){null===_initUrlParams&&(e.target=_target,_initUrlParams=e)},setJobsPerPage:function(e){_jobsPerPage=e},setJobsPage:function(e){_jobsPage=e},getJobsPerPage:function(){return _jobsPerPage},getJobsPage:function(){return _jobsPage}}}]),angular.module("app.infobar",[]).directive("viewInfobar",["Data","QueryService",function(a,i){return{restrict:"E",scope:{},templateUrl:"partials/infobar.html",link:function(n,e,t){n.expandedIndexes=[],n.expandChange=function(e){var t;n.isExpanded(e)?(t=_.indexOf(n.expandedIndexes,e),n.expandedIndexes.splice(t,1)):n.expandedIndexes.push(e)},n.isExpanded=function(e){return-1<n.expandedIndexes.indexOf(e)},n.formatChangeMsg=function(e){var e=e.split("\n"),t=e[0];return t=1<e.length?'<a href="'+e[2].replace("Reviewed-on: ","")+'">'+t+"</a>":t},n.$watch(function(){return a.getBuild()},function(r,e){n.hasChangeSet=!1;var t=a.getCurrentTarget();i.getBuildInfo(r,t).then(function(e){var t=e.value;e.err?console.log(r,e.err):(n.info=t,n.hasChangeSet=!0)})})}}}]);var jiraPrefixes=["MB","CBQE","CBIT","CBD","CBSP"];function msToTime(e){var t=(e=(e-e%1e3)/1e3)%60,r=(e=(e-t)/60)%60,e=(e-r)/60;return(e<10?"0"+e:e)+":"+(r<10?"0"+r:r)+":"+(t<10?"0"+t:t)}function msToDate(e){var e=new Date(e),t=e.getUTCHours()+":"+e.getUTCMinutes();return e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear()+" - "+t}formatClaim=function(t){var r=t;return _.forEach(jiraPrefixes,function(e){if(t.startsWith(e+"-"))return r='<a target="_blank" href="https://issues.couchbase.com/browse/'+t+'">'+t+"</a>",!1}),r},angular.module("app.main",[]).controller("NavCtrl",["$scope","$state","$stateParams","Data","target","targetVersions","version",function(e,t,r,n,a,i,o){i=_.compact(i),n.setTarget(a),n.setSelectedVersion(o),n.setTargetVersions(i),t.go("target.version.builds.build"),e.changeTarget=function(e){"cblite"==e||"sync_gateway"==e?n.setBuildFilter(0):n.setBuildFilter(2e3),t.go("target.version",{target:e,version:"latest"})},e.changeVersion=function(e){e!=o&&(n.setBuildsFilter(10),t.go("target.version",{version:e}))}}]).controller("TimelineCtrl",["$scope","$state","versionBuilds","Data",function(t,r,e,n){t.versionBuilds=e,t.onBuildChange=function(e){t.build=e,n.setBuild(e),-1!=e.indexOf("-")&&(e=e.split("-")[1]),r.go("target.version.builds.build",{build:e})},t.$watch(function(){return n.getBuild()},function(e){t.build=e}),r.go("target.version.builds.build",{build:"latest"})}]).controller("JobsCtrl",["$rootScope","$scope","$state","$stateParams","Data","buildJobs","QueryService",function(o,m,e,t,s,r,l){var b={"git error":["hudson.plugins.git.GitException","python3: can't open file 'testrunner.py': [Errno 2] No such file or directory"],"SSH error":["paramiko.ssh_exception.SSHException","Exception SSH session not active occurred on"],"IPv6 test on IPv4 host":["Cannot enable IPv6 on an IPv4 machine"],"Python SDK error (CBQE-6230)":["ImportError: cannot import name 'N1QLQuery' from 'couchbase.n1ql'"],"Syntax error":["KeyError:","TypeError:"],"json.decoder.JSONDecodeError:":["json.decoder.JSONDecodeError:"],"ServerUnavailableException: unable to reach the host":["ServerUnavailableException: unable to reach the host"],"Node already added to cluster":["ServerAlreadyJoinedException:"],"CBQ Error":["membase.api.exception.CBQError:","CBQError: CBQError:"],"RBAC error":['Exception: {"errors":{"roles":"Cannot assign roles to user because the following roles are unknown, malformed or role parameters are undefined: [security_admin]"}}'],"Rebalance error":["membase.api.exception.RebalanceFailedException"],"Build download failed":["Unable to copy build to","Unable to download build in"],"install not started":["INSTALL NOT STARTED ON"],"install failed":["INSTALL FAILED ON"],"No test report xml":["No test report files were found. Configuration error?"]};function h(){s.setJobsPage(0),"All"===s.getJobsPerPage()&&(m.jobsPerPage=m.panelTabs[m.activePanel].jobs.length)}function n(e){if(e&&0!==e.length)try{d3.select("#trend-chart").selectAll("*").remove();var t,r,n,a,i,o,s,l,u,c,d,p,f,g,m,b=40,h=30,v=80,y=60,_=document.getElementById("trend-chart-container");_?(t=_.offsetWidth-y-h,r=400-b-v,t<=0||r<=0?console.error("Invalid dimensions:",t,r):(n=d3.select("#trend-chart").attr("width",t+y+h).attr("height",r+b+v).append("g").attr("transform","translate("+y+","+b+")"),a=e.slice().sort(function(e,t){var r=parseInt(e.version.split("-")[1]||"0"),n=parseInt(t.version.split("-")[1]||"0");return r!==n?r-n:e.run_number-t.run_number}),i=[],a.forEach(function(e){-1===i.indexOf(e.version)&&i.push(e.version)}),o=d3.scale.ordinal().domain(i).rangePoints([0,t],1),s=d3.max(a,function(e){return e.run_number})||1,l=d3.scale.linear().domain([.5,s+.5]).nice().range([r,0]),u={},a.forEach(function(e){u[e.version]||(u[e.version]=[]),u[e.version].push(e)}),c=[],i.forEach(function(r){var n=u[r],a=Math.min(30,t/i.length*.3);n.forEach(function(e,t){t=1<n.length?(t-(n.length-1)/2)*(a/n.length):0;c.push({data:e,x:o(r)+t,y:l(e.run_number)})})}),(d=n.selectAll(".run-circle").data(c).enter().append("circle").attr("class","run-circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",0).attr("fill",function(e){return"pass"===e.data.result?"#28a745":"#dc3545"}).attr("stroke",function(e){return"pass"===e.data.result?"#1e7e34":"#a71e2a"}).attr("stroke-width",2).attr("opacity",.8).style("cursor","pointer")).transition().duration(800).delay(function(e,t){return 30*t}).attr("r",function(e){return 6+(1===e.data.run_number?2:0)}).attr("opacity",.9),d.on("mouseover",function(e){d3.select(this).transition().duration(200).attr("r",10).attr("opacity",1).attr("stroke-width",3);var t=d3.select("body").append("div").attr("class","trend-tooltip").style("opacity",0).style("position","absolute").style("background","rgba(0, 0, 0, 0.9)").style("color","#fff").style("padding","10px 14px").style("border-radius","6px").style("pointer-events","none").style("font-size","13px").style("z-index","10001").style("box-shadow","0 4px 12px rgba(0,0,0,0.3)"),r="<strong>"+e.data.result.toUpperCase()+"</strong><br/>Version: "+e.data.version+"<br/>Run #: "+e.data.run_number,e=(e.data.url&&(r+="<br/><a href='"+e.data.url+"' target='_blank' style='color: #9b8fff; text-decoration: underline;'>View Job →</a>"),t.html(r),t.transition().duration(200).style("opacity",1),d3.mouse(document.body));t.style("left",e[0]+15+"px").style("top",e[1]-10+"px")}).on("mousemove",function(e){var t=d3.mouse(document.body);d3.select(".trend-tooltip").style("left",t[0]+15+"px").style("top",t[1]-10+"px")}).on("mouseout",function(e){d3.select(this).transition().duration(200).attr("r",function(e){return 6+(1===e.data.run_number?2:0)}).attr("opacity",.9).attr("stroke-width",2),d3.selectAll(".trend-tooltip").remove()}),p=c.slice().sort(function(e,t){var r=parseInt(e.data.version.split("-")[1]||"0"),n=parseInt(t.data.version.split("-")[1]||"0");return r!==n?r-n:e.data.run_number-t.data.run_number}),f=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear"),n.append("path").datum(p).attr("class","trend-line").attr("d",f).attr("fill","none").attr("stroke","#667EEA").attr("stroke-width",2).attr("opacity",.6).style("pointer-events","none"),i.forEach(function(t){var e,r=c.filter(function(e){return e.data.version===t});1<r.length&&(r=r.map(function(e){return[e.x,e.y]}),e=d3.svg.line().x(function(e){return e[0]}).y(function(e){return e[1]}).interpolate("linear"),n.append("path").datum(r).attr("class","version-line").attr("d",e).attr("fill","none").attr("stroke","#999").attr("stroke-width",1.5).attr("stroke-dasharray","3,3").attr("opacity",.5).style("pointer-events","none"))}),g=d3.svg.axis().scale(o).orient("bottom").tickSize(6).tickPadding(8),n.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(g).selectAll("text").style("text-anchor","middle").style("font-size","11px").attr("dy",".35em"),m=d3.svg.axis().scale(l).orient("left").ticks(Math.min(10,s)).tickSize(6).tickPadding(8),n.append("g").attr("class","y axis").call(m),n.append("text").attr("transform","rotate(-90)").attr("y",0-y).attr("x",0-r/2).attr("dy","1em").style("text-anchor","middle").style("font-size","13px").style("font-weight","600").style("fill","#333").text("Run Number"),n.append("text").attr("transform","translate("+t/2+" ,"+(r+v-10)+")").style("text-anchor","middle").style("font-size","13px").style("font-weight","600").style("fill","#333").text("Version"),console.log("Chart rendered successfully"))):console.error("Chart container not found")}catch(e){console.error("Error rendering chart:",e)}else console.log("No trend data to render")}function u(e,t){void 0===t&&(t=!0),e=_.reject(e,"olderBuild",!0),e=_.reject(e,"deleted",!0),""!==m.search&&(e=_.reject(e,function(e){return!(e.bugs.includes(m.search)||e.claim.includes(m.search)||e.name.includes(m.search)||e.triage.includes(m.search))}));var a,i,o,s,l,r=_.uniq(_.reject(e,["result","PENDING"])),n=_.uniq(_.filter(e,["result","SUCCESS"])),u=_.uniq(_.filter(e,["result","ABORTED"])),c=_.uniq(_.filter(e,["result","UNSTABLE"])),d=_.uniq(_.filter(e,["result","INST_FAIL"])),p=_.uniq(_.filter(e,["result","FAILURE"])),f=_.uniq(_.filter(e,["result","PENDING"])),g=_.uniq(_.filter(e,function(e){return 0<e.skipCount}));m.panelTabs=[{title:"Jobs Completed",jobs:r,active:!0},{title:"Jobs Success",jobs:n},{title:"Jobs Aborted",jobs:u},{title:"Jobs Unstable",jobs:c},{title:"Jobs Failed",jobs:p},{title:"Jobs Install Failed",jobs:d},{title:"Jobs Skipped",jobs:g},{title:"Jobs Pending",jobs:f}],m.variantNames=[],_.forEach(e,function(e){e.variants&&_.forEach(e.variants,function(e,t){m.variantNames.includes(t)||m.variantNames.push(t)})}),m.variantNames.sort(function(e,t){e=e.toLowerCase(),t=t.toLowerCase();return e<t?-1:t<e?1:0}),m.variantName=function(e){return e.split("_").map(function(e){return e[0].toUpperCase()+e.slice(1)}).join(" ")},r=e,a={Analyzed:0},i=0,_.forEach(Object.keys(b),function(e){a[e]={jobCount:0,skippedTestCount:0,failedTestCount:0}}),o={},_.forEach(jiraPrefixes,function(e){o[e]=0}),s={},_.forEach(jiraPrefixes,function(e){s[e]=[]}),_.forEach(r,function(r){var n=[];_.forEach(r.bugs,function(e){try{var t=e.split("-")[0];jiraPrefixes.includes(t)&&(n.includes(e)||(a[e]?(a[e].jobCount+=1,a[e].failedTestCount+=r.failCount,a[e].skippedTestCount+=r.skipCount):a[e]={jobCount:1,failedTestCount:r.failCount,skippedTestCount:r.skipCount},o[t]+=1,n.push(e)),s[t].includes(e)||s[t].push(e))}catch(e){console.error(e)}}),_.forEach(r.claim.split("<br><br>"),function(t){""===t||r.olderBuild||_.forEach(Object.keys(a),function(e){if(t.startsWith(e))return n.includes(e)||(n.push(e),a[e].jobCount+=1,a[e].failedTestCount+=r.failCount,a[e].skippedTestCount+=r.skipCount),!1})})}),l=[],_.forEach(Object.entries(a),function(e){var t=e[1].jobCount,r=e[1].failedTestCount,n=e[1].skippedTestCount;0<t&&(i+=t,l.push({claim:e[0],skippedTestCount:n,failedTestCount:r,jobCount:t}))}),s.IT=s.CBD.concat(s.CBIT),delete s.CBD,delete s.CBIT,o.IT=o.CBD+o.CBIT,delete o.CBD,delete o.CBIT,m.jiraCounts=Object.entries(o).map(function(e){var t,r=e[0];return"MB"===r?t="Product bugs (MB)":"CBQE"===r?t="Test bugs (CBQE)":"IT"===r?t="IT bugs (CBIT/CBD)":"CBSP"===r&&(t="Support bugs (CBSP)"),{name:t,count:e[1],percent:0==i?0:(e[1]/i*100).toFixed(0),unique:s[r].length}}).filter(function(e){return 0<e.count}),m.claimSummary=l,m.totalClaims=i,m.needToAnalyseCount=r.filter(function(e){return!e.olderBuild&&!e.deleted&&(!["PENDING","SUCCESS"].includes(e.result)||"PENDING"===e.result&&""!==e.claim)}).length,m.analysedPercent=0==m.needToAnalyseCount?0:(m.totalClaims/m.needToAnalyseCount*100).toFixed(0),t&&h()}m.formatClaim=formatClaim,m.openClaims=new Set,m.openClaim=function(e){m.openClaims.add(e)},m.closeClaim=function(e){m.openClaims.remove(e)},m.jiraCounts=[],m.showAnalysis=!1,m.changeShowAnalysis=function(){m.showAnalysis=!m.showAnalysis},m.predicate="result",m.reverse=!0,m.activePanel=0,m.targetBy=s.getCurrentTarget(),m.jobsPerPage=s.getJobsPerPage(),m.jobsPage=s.getJobsPage(),m.$watch(function(){return s.getJobsPage()},function(e){m.jobsPage=e}),m.$watch(function(){return s.getJobsPerPage()},function(e){"All"===(e=e)&&(e=m.panelTabs[m.activePanel].jobs.length),m.jobsPerPage=e,m.jobsPage>Math.max(0,m.numPages()-1)&&s.setJobsPage(m.numPages()-1)}),m.nextPage=function(){m.nextPageExists()&&s.setJobsPage(m.jobsPage+1)},m.prevPage=function(){0<m.jobsPage&&s.setJobsPage(m.jobsPage-1)},m.nextPageExists=function(){return jobsLength=m.panelTabs[m.activePanel].jobs.length,(m.jobsPage+1)*m.jobsPerPage<jobsLength-1},m.setPage=function(){s.setJobsPage(this.n)},m.numPages=function(){return jobsLength=m.panelTabs[m.activePanel].jobs.length,0===m.jobsPerPage?0:Math.ceil(jobsLength/m.jobsPerPage)},m.pageNumbers=function(){var e=m.jobsPage-5,t=(e<0&&(e=0),m.jobsPage+5),r=m.numPages();return r<t&&(t=r),_.range(e,t)},m.predicate="name",m.reverse=!1,m.onselect=function(t,r,n,e){var a=s.getActiveJobs(),i=s.getCurrentTarget(),a=(a=_.reject(a,"deleted",!0)).filter(function(e){return e.name===t&&e.os===r&&e.component===n});m.model={},m.model.bestRun=a.find(function(e){return!1===e.olderBuild}).build_id.toString(),m.model.changeBestRun=function(){void 0!==m.model.bestRun&&(_.forEach(m.selectedjobdetails,function(e){e.build_id===parseInt(m.model.bestRun)?e.olderBuild=!1:e.olderBuild=!0}),u(s.getActiveJobs(),!1),o.$broadcast("recalculateStats"),l.setBestRun(i,t,m.model.bestRun,r,n,m.selectedbuild))},m.len=a.length,m.selectedjobdetails=a,m.selectedjobname=a[0].displayName,m.selectedbuild=a[0].build},m.trendData=null,m.trendLoading=!1,m.trendJobName="",m.trendBaseVersion="",m.trendChartType="scatter",m.toggleChartType=function(){m.trendChartType="scatter"===m.trendChartType?"bar":"scatter",m.trendData&&m.trendData.trend&&setTimeout(function(){("scatter"===m.trendChartType?n:e=>{if(e&&0!==e.length)try{d3.select("#trend-chart").selectAll("*").remove();var t,c,d,r,n,a,p,i,f,g,m,o,s,l=40,u=30,b=80,h=60,v=document.getElementById("trend-chart-container");v?(t=v.offsetWidth-h-u,c=400-l-b,t<=0||c<=0?console.error("Invalid dimensions:",t,c):(d=d3.select("#trend-chart").attr("width",t+h+u).attr("height",c+l+b).append("g").attr("transform","translate("+h+","+l+")"),r=e.slice().sort(function(e,t){var r=parseInt(e.version.split("-")[1]||"0"),n=parseInt(t.version.split("-")[1]||"0");return r!==n?r-n:e.run_number-t.run_number}),n={},r.forEach(function(e){n[e.version]||(n[e.version]=[]),n[e.version].push(e)}),a=Object.keys(n).sort(function(e,t){return parseInt(e.split("-")[1]||"0")-parseInt(t.split("-")[1]||"0")}),p=d3.scale.ordinal().domain(a).rangeBands([0,t],.2),i=d3.max(r,function(e){return e.run_number})||1,f=d3.scale.linear().domain([0,i]).nice().range([c,0]),g=.6*p.rangeBand(),m=(p.rangeBand()-g)/2,a.forEach(function(e,a){var i=n[e].slice().sort(function(e,t){return e.run_number-t.run_number}),o=p(e)+m,s=c,l=0,u=0;i.forEach(function(e,t){var r=f(e.run_number),n=(0===t?c:f(u))-r,e=(u=e.run_number,d.append("rect").attr("class","trend-bar-segment").attr("x",o).attr("y",s).attr("width",g).attr("height",0).attr("fill","pass"===e.result?"#28a745":"#dc3545").attr("stroke","pass"===e.result?"#1e7e34":"#a71e2a").attr("stroke-width",2).attr("opacity",.9).style("cursor","pointer").datum({data:e,runIndex:t,totalRuns:i.length}));e.transition().duration(400).delay(150*a+l).attr("y",r).attr("height",n).attr("opacity",.9),l+=80,s=r,e.on("mouseover",function(e){d3.select(this).transition().duration(200).attr("opacity",1).attr("stroke-width",4).attr("stroke","#fff");var t=d3.select("body").append("div").attr("class","trend-tooltip").style("opacity",0).style("position","absolute").style("background","rgba(0, 0, 0, 0.9)").style("color","#fff").style("padding","10px 14px").style("border-radius","6px").style("pointer-events","none").style("font-size","13px").style("z-index","10001").style("box-shadow","0 4px 12px rgba(0,0,0,0.3)"),r="<strong>"+e.data.result.toUpperCase()+"</strong><br/>Version: "+e.data.version+"<br/>Run #: "+e.data.run_number+" of "+e.totalRuns,e=(e.data.url&&(r+="<br/><a href='"+e.data.url+"' target='_blank' style='color: #9b8fff; text-decoration: underline;'>View Job →</a>"),t.html(r),t.transition().duration(200).style("opacity",1),d3.mouse(document.body));t.style("left",e[0]+15+"px").style("top",e[1]-10+"px")}).on("mousemove",function(e){var t=d3.mouse(document.body);d3.select(".trend-tooltip").style("left",t[0]+15+"px").style("top",t[1]-10+"px")}).on("mouseout",function(e){d3.select(this).transition().duration(200).attr("opacity",.9).attr("stroke-width",2).attr("stroke",function(){return"pass"===e.data.result?"#1e7e34":"#a71e2a"}),d3.selectAll(".trend-tooltip").remove()})})}),o=d3.svg.axis().scale(p).orient("bottom").tickSize(6).tickPadding(8),d.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(o).selectAll("text").style("text-anchor","middle").style("font-size","11px").attr("dy",".35em"),s=d3.svg.axis().scale(f).orient("left").ticks(Math.min(10,i)).tickSize(6).tickPadding(8),d.append("g").attr("class","y axis").call(s),d.append("text").attr("transform","rotate(-90)").attr("y",0-h).attr("x",0-c/2).attr("dy","1em").style("text-anchor","middle").style("font-size","13px").style("font-weight","600").style("fill","#333").text("Run Number"),d.append("text").attr("transform","translate("+t/2+" ,"+(c+b-10)+")").style("text-anchor","middle").style("font-size","13px").style("font-weight","600").style("fill","#333").text("Version"),console.log("Bar chart rendered successfully"))):console.error("Chart container not found")}catch(e){console.error("Error rendering bar chart:",e)}else console.log("No trend data to render")})(m.trendData.trend)},100)},o.$on("openTrendModal",function(e,t){m.trendData=t.trendData,m.trendJobName=t.jobName,m.trendBaseVersion=t.baseVersion,m.trendLoading=!1,m.trendChartType="scatter",$("#trendModal").modal("show"),$("#trendModal").on("shown.bs.modal",function(){m.$apply(function(){m.trendData&&m.trendData.trend&&setTimeout(function(){n(m.trendData.trend)},100)})}),setTimeout(function(){var e;m.trendData&&m.trendData.trend&&(e=document.getElementById("trend-chart-container"))&&0<e.offsetWidth&&n(m.trendData.trend)},500)}),m.search="",m.onSearchChange=function(){u(a=s.getActiveJobs())},m.searchClaim=function(e){m.search===e?m.search="":m.search=e,m.onSearchChange()};s.getBuild();var a=r;u(a),s.setBuildJobs(a);var i={platforms:_.uniq(_.map(a,"os")).map(function(e){return{key:e,disabled:!1}}),features:_.uniq(_.map(a,"component")).map(function(e){return{key:e,disabled:!1}}),serverVersions:_.uniq(_.map(_.filter(r,function(e){return void 0!==e.server_version}),"server_version")).map(function(e){return{key:e,disabled:!1}}),dapiVersions:_.uniq(_.map(_.filter(r,function(e){return void 0!==e.dapi}),"dapi")).map(function(e){return{key:e,disabled:!1}}),nebulaVersions:_.uniq(_.map(_.filter(r,function(e){return void 0!==e.dni}),"dni")).map(function(e){return{key:e,disabled:!1}}),envVersions:_.uniq(_.map(_.filter(r,function(e){return void 0!==e.env}),"env")).map(function(e){return{key:e,disabled:!1}})},c=[];_.forEach(a,function(e){e.variants&&_.forEach(Object.keys(e.variants),function(e){c.includes(e)||c.push(e)})}),_.forEach(c,function(t){i[t]=_.uniq(_.map(_.filter(a,function(e){return e.variants&&void 0!==e.variants[t]}),"variants."+t)).map(function(e){return{key:e,disabled:!1}})}),s.setSideBarItems(i),m.changePanelJobs=function(e){m.activePanel=e,h()},m.msToTime=msToTime,m.msToDate=msToDate,m.timestampToDate=function(e){return e?new Date(e).toLocaleString():""},m.$watch(function(){return s.getActiveJobs()},function(e){e&&u(e)})}]).controller("JobDetailsCtrl",["$scope","$state","$stateParams","Data","target",function(t,e,r,n,a){t.openClaims=[],t.msToTime=msToTime,t.msToDate=msToDate;var i=r.jobName;t.$watch(function(){return n.getActiveJobs()},function(e){e=_.reject(e,"deleted",!0);e=_.filter(e,["name",i]);t.jobDetails=e,t.jobname=i,t.build=e[0].build})}]).directive("claimTest",[function(){return{scope:{claim:"="},templateUrl:"partials/claim.html",link:function(e,t){for(var r=e.$parent.job.name,n=(e.formatClaim=formatClaim,e.shortClaim=e.claim.length<50?e.claim:e.claim.split("<br><br>")[0].slice(0,50)+"...",t.parent());n.length&&"TD"!==n[0].tagName;)n=n.parent();e.scope={showFullClaim:e.$parent.$parent.openClaims.has(r),changeShowFullClaim:function(){this.showFullClaim?(e.$parent.$parent.openClaims.delete(r),n.length&&n.removeClass("claim-expanded")):(e.$parent.$parent.openClaims.add(r),n.length&&n.addClass("claim-expanded")),this.showFullClaim=!this.showFullClaim}},e.scope.showFullClaim&&n.length&&n.addClass("claim-expanded")}}}]).directive("claimCell",["Data","QueryService",function(u,c){return{restrict:"E",scope:{job:"="},templateUrl:"partials/claimcell.html",link:function(l,e,t){l.editClaim=!1,l.scope={bugsText:l.job.bugs.join(", "),saveClaim:function(){var e,t,r,n,a,i,o=this.bugsText,s=!0;""===o?o=[]:(o=o.split(",").map(function(e){return e.trim()}),_.forEach(o,function(t){console.log(t);var r=!1;if(_.forEach(jiraPrefixes,function(e){t.startsWith(e+"-")&&!isNaN(t.split("-")[1])&&(r=!0)}),!r)return s=!1})),s?(l.job.bugs=o,e=u.getCurrentTarget(),t=l.job.name,r=l.job.build_id,o=l.job.bugs,n=l.job.os,a=l.job.component,i=l.job.build,c.claimJob("bugs",e,t,r,o,n,a,i).catch(function(e){alert("error saving claim: "+e.err)}).then(function(){l.editClaim=!1})):alert("Invalid bugs list, must be "+jiraPrefixes.join(", "))}},l.formatBugs=function(){return l.job.bugs.map(function(e){return'<a target="_blank" href="https://issues.couchbase.com/browse/'+e+'">'+e+"</a>"}).join(", ")}}}}]).directive("triageCell",["Data","QueryService",function(l,u){return{restrict:"E",scope:{job:"="},templateUrl:"partials/triagecell.html",link:function(s,e,t){s.editClaim=!1,s.saveClaim=function(){var e=l.getCurrentTarget(),t=s.job.name,r=s.job.build_id,n=s.job.triage,a=s.job.os,i=s.job.component,o=s.job.build;u.claimJob("triage",e,t,r,n,a,i,o).catch(function(e){alert("error saving claim: "+e.err)}).then(function(){s.editClaim=!1})}}}}]).directive("pagination",["Data",function(n){return{restrict:"E",scope:{},templateUrl:"partials/pagination.html",link:function(t,e,r){t.jobsPage=n.getJobsPage(),t.nextPageExists=t.$parent.nextPageExists,t.pageNumbers=t.$parent.pageNumbers,t.nextPage=t.$parent.nextPage,t.prevPage=t.$parent.prevPage,t.setPage=t.$parent.setPage,t.jobsPerPageChoices=[20,50,100,500,1e3,"All"],t.jobsPerPage=n.getJobsPerPage(),t.$watch(function(){return n.getJobsPage()},function(e){t.jobsPage=e}),t.$watch(function(){return n.getJobsPerPage()},function(e){t.jobsPerPage=e}),t.onJobsPerPageChange=function(){n.setJobsPerPage(t.jobsPerPage)}}}}]).directive("trendButton",["QueryService","$rootScope",function(n,a){return{restrict:"E",scope:{job:"=",build:"="},templateUrl:"partials/trend_button.html",link:function(r,e,t){r.loading=!1,r.error=!1,r.openTrend=function(){var t,e;r.loading||((t=r.build?r.build.split("-")[0]:"")&&r.job?(e=t+"_"+r.job.os+"_"+r.job.component+"_"+r.job.name,r.loading=!0,r.error=!1,n.getTrend(e).then(function(e){r.loading=!1,e?a.$broadcast("openTrendModal",{trendData:e,jobName:r.job.displayName||r.job.name,baseVersion:t}):alert("No trend data found for this job")}).catch(function(e){r.loading=!1,r.error=!0;e=e.data&&e.data.error?e.data.error:"Failed to fetch trend data";alert(e)})):alert("Unable to determine base version or job information"))}}}}]).directive("rerunButton",["QueryService",function(n){return{restrict:"E",scope:{job:"="},templateUrl:"partials/rerun_button.html",link:function(t,e,r){t.submitting=!1,t.error=!1,t.dispatched=!1,t.isRerunDisabled=function(){return t.job.runCount&&2<t.job.runCount},t.rerunJob=function(){t.isRerunDisabled()?alert("Rerun disabled: Job has more than 3 runs ("+t.job.runCount+" runs)"):confirm("Rerun "+t.job.name+"?")&&(t.error=!1,t.submitting=!0,t.dispatched=!1,n.rerunJob(t.job.url+t.job.build_id,null).then(function(){t.submitting=!1,t.dispatched=!0}).catch(function(e){t.submitting=!1,t.error=!0,e.data.err&&alert(e.data.err)}))},t.btnText=function(){return t.isRerunDisabled()?"Max runs reached":t.error?"Error dispatching":t.submitting?"Dispatching...":t.dispatched?"Dispatched":"Rerun"}}}}]),angular.module("svc.query",[]).service("QueryService",["$http","Data",function(l,e){return{getVersions:function(e){e=["versions",e].join("/");return l({url:e,cache:!0}).then(function(e){return e.data})},getBuilds:function(e,t,r,n){e=["builds",e,t,r,n].join("/");return l({url:e,cache:!0}).then(function(e){return e.data})},getJobs:function(e,t){e=["jobs",e,t].join("/");return l({url:e,cache:!0}).then(function(e){return e.data})},getBuildInfo:function(e,t){e=["info",e,t].join("/");return l({url:e,cache:!0}).then(function(e){return e.data})},claimJob:function(e,t,r,n,a,i,o,s){t=["claim",t,r,n].join("/");return l.post(t,{type:e,claim:a,os:i,comp:o,build:s})},getBuildSummary:function(e){e=["getBuildSummary",e].join("/");return l({url:e,cache:!0}).then(function(e){return e.data})},setBestRun:function(e,t,r,n,a,i){e=["setBestRun",e,t,r].join("/");return l.post(e,{os:n,comp:a,build:i})},rerunJob:function(e,t){return l.post("rerunJob",{cherryPick:t,jobUrl:e})},getReport:function(e,t){e=["report",e,t].join("/");return l({url:e}).then(function(e){return e.data}).catch(function(e){if(404===e.status)return null;throw e})},getTrend:function(e){e=["trend",e].join("/");return l({url:e}).then(function(e){return e.data}).catch(function(e){if(404===e.status)return null;throw e})}}}]),angular.module("app.sidebar",[]).directive("viewSidebar",["Data",function(n){return{restrict:"E",scope:{},templateUrl:"partials/sidebar.html",link:function(r,e,t){r.showPerc=!1,r.disabled={},r.buildVersion=n.getBuild(),r.targetBy=n.getCurrentTarget(),r.toggleAll=function(e){var t=!r.disabled[e];r.disabled[e]=t,n.toggleAllSidebarItems(e,t)},r.variantName=function(e){return e.split("_").map(function(e){return e[0].toUpperCase()+e.slice(1)}).join(" ")},r.$watch(function(){return n.getSideBarItems()},function(e,t){e&&(r.buildVersion=e.buildVersion,r.sidebarItems={},_.forEach(e,function(e,t){"buildVersion"!==t&&(r.sidebarItems[t]=_.map(e,"key"),void 0===r.disabled[t])&&(r.disabled[t]=!1)}),r.sidebarItemsVariants=Object.keys(r.sidebarItems).filter(function(e){return!["platforms","features","serverVersions","dapiVersions","nebulaVersions","envVersions"].includes(e)}).sort(function(e,t){e=e.toLowerCase(),t=t.toLowerCase();return e<t?-1:t<e?1:0}),_.forEach(e,function(e,t){"buildVersion"!==t&&(noDisabled=!_.some(_.map(e,"disabled")),r.disabled[t]=!noDisabled)}))},!0)}}}]).directive("sidebarItem",["Data","$rootScope",function(n,a){return{restrict:"E",scope:{type:"@",key:"@",asNum:"&showPerc"},templateUrl:"partials/sidebar_item.html",link:function(r,e,t){r.disabled=!1,r.stats=n.getItemStats(r.key,r.type),r.showDashboardUrls="server"===n.getCurrentTarget()&&"7.0.0"===n.getSelectedVersion(),r.openAIReport=function(e){e.stopPropagation();var e=n.getBuild(),t=r.key;a.$broadcast("openAIReport",{version:e,component:t})},r.getRunPercent=function(){if(!r.disabled)return r.stats.percStats.run},r.getRunPercentNum=function(){var e;return r.disabled||!r.stats||!r.stats.percStats||!(e=r.stats.percStats.run)||(e="string"==typeof e?parseFloat(e.replace("%","").replace(/\s/g,"")):parseFloat(e),isNaN(e))?0:Math.max(0,Math.min(100,e))},r.getDashboardUrl=function(){var e;return r.showDashboardUrls&&(e={"2I_MOI":"ovawbLBGk",ANALYTICS:"Qb8QbYfGz",BACKUP_RECOVERY:"Dv_QxLfGz",BUILD_SANITY:"IPm-bSLMk",CE_ONLY:"80ZuxLBGk",CLI:"U6gubLfMz",COLLECTIONS:"BGtwbLfMk",DURABILITY:"qH5QbYBMz",EP:"aTj_xYBGk",EVENTING:"k2QQbLfMk",FTS:"pBAwxLfGk",GEO:"Dn4ubYfGz",GOXDCR:"h1JQbLfGz",IPV6:"K_rQxLBGz",LOG_REDACTION:"Cv7XxYfMz",MAGMA:"09PQxLBMz",MOBILE:"QMRuxYBGz",MOBILE_CONVERGENCE:"LyywbLfGk",NSERV:"iUowxYfGz",OS_CERTIFY:"Od2-6tfMk",QUERY:"C2dQxYBMk",RQG:"tnfwbYBMk",RZA:"iRIubYBMz",SANITY:"tGRa6tBMk",SECURITY:"SpxQxYfGk",SUBDOC:"feuQbYBGz",TUNABLE:"_LmXxYBMk",UNIT:"fKMuxYBMk",UPGRADE:"ftKwxYfGz",VIEW:"-_zubYBMk"}[r.key])?"http://qe.service.couchbase.com:3000/d/"+e:null},r.getNumOrPerc=function(e){var t=r.stats;return(r.asNum()?t.absStats:t.percStats)[e]},r.toggleItem=function(){"build"!=r.type&&n.toggleItem(r.key,r.type,!r.disabled)},r.bgColor=function(){var e="greyed",t=r.stats;return r.disabled?r.glyphiconClass="glyphicon-unchecked":(r.glyphiconClass="glyphicon-check",100==(passPerc=t.percStats.passedRaw)?e="bg-success":70<=passPerc?e="bg-warning":0<=passPerc&&(e=0<t.absStats.failed?"bg-danger":"bg-muted")),e},r.$watch(function(){return n.getSideBarItems()},function(e){e=_.find(e[r.type],{key:r.key});e&&(r.disabled=e.disabled),r.stats=n.getItemStats(r.key,r.type)},!0),r.$on("recalculateStats",function(){r.stats=n.getItemStats(r.key,r.type)})}}}]),angular.module("app.target",[]).directive("targetSelector",["ViewTargets","Data",function(n,a){return{restrict:"E",scope:{changeTarget:"="},templateUrl:"partials/targets.html",link:function(t,e,r){t.$watch(function(){return a.getCurrentTarget()},function(e){e&&(t.viewTargets=n.allTargets(),t.targetBy=n.getTarget(e))})}}}]).directive("filterSelector",["Data","QueryService",function(i,o){return{restrict:"E",scope:{changeFilter:"="},templateUrl:"partials/filters.html",link:function(a,e,t){a.activeFilter=i.getBuildFilter(),a.passFilters=[0,2e3,5e3],a.changeFilter=function(e){var t=i.getCurrentTarget(),r=i.getSelectedVersion(),n=i.getBuildsFilter();o.getBuilds(t,r,e,n).then(function(e){return i.setVersionBuilds(e),i.setBuildFilter(a.activeFilter),i.getVersionBuilds()}),a.activeFilter=e}}}}]).directive("buildsFilterSelector",["Data","QueryService",function(i,o){return{restrict:"E",scope:{changeBuildsFilter:"=?"},templateUrl:"partials/buildsfilters.html",link:function(a,e,t){a.activeBuildFilter=i.getBuildsFilter(),a.buildsFilters=[5,10,25,100],a.changeBuildsFilter=function(e){var t=i.getCurrentTarget(),r=i.getSelectedVersion(),n=i.getBuildFilter();o.getBuilds(t,r,n,e).then(function(e){return i.setVersionBuilds(e),i.setBuildsFilter(a.activeBuildFilter),i.getVersionBuilds()}),a.activeBuildFilter=e}}}}]).directive("versionSelector",["$stateParams","ViewTargets","QueryService","Data",function(e,t,r,a){return{restrict:"E",templateUrl:"partials/versions.html",scope:{changeVersion:"="},link:function(r,e,t){r.hasNext=!0,r.hasPrevious=!0;function n(){var e=r.versionGroups.length-1;r.hasNext=0!=r.groupIndex,r.hasPrevious=r.groupIndex!=e}r.showPrevious=function(){r.hasPrevious&&(r.groupIndex++,r.targetVersions=r.versionGroups[r.groupIndex],n())},r.showNext=function(){r.hasNext&&(r.groupIndex--,r.targetVersions=r.versionGroups[r.groupIndex],n())},r.$watch(function(){return a.getSelectedVersion()},function(e){var t;e&&(r.version=e,(t=_.clone(a.getTargetVersions())).reverse(),e=_.indexOf(t,e),r.versionGroups=_.map(_.chunk(t,5),function(e){return e.reverse(),e}),r.groupIndex=Math.floor(e/5),r.targetVersions=r.versionGroups[r.groupIndex],n())})}}}]).factory("ViewTargets",["COUCHBASE_TARGET","SDK_TARGET","SG_TARGET","CBLITE_TARGET","CBO_TARGET","CAPELLA_TARGET","SERVERLESS_TARGET",function(e,t,r,n,a,i,o){var s={},l=(l=[e,t,r,n,a,i,o]).map(function(e,t){return e.i=t,s[e.bucket]=e});return{allTargets:function(){return l},getTarget:function(e){return s[e]}}}]).value("COUCHBASE_TARGET",{title:"Couchbase Server",bucket:"server",key:"abspassed",value:100,options:[0,50,100,500]}).value("SDK_TARGET",{title:"SDK",bucket:"sdk",key:"abspassed",value:100,options:[0,50,100,500]}).value("SG_TARGET",{title:"Sync Gateway",bucket:"sync_gateway",key:"abspassed",value:0,options:[0,50,100,500]}).value("CBLITE_TARGET",{title:"Couchbase Lite",bucket:"cblite",key:"abspassed",value:0,options:[0,50,100,500]}).value("CBO_TARGET",{title:"Couchbase Operator",bucket:"operator",key:"abspassed",value:0,options:[0,50,100,500]}).value("CAPELLA_TARGET",{title:"Capella",bucket:"capella",key:"abspassed",value:0,options:[0,50,100,500]}).value("SERVERLESS_TARGET",{title:"Serverless",bucket:"serverless",key:"abspassed",value:0,options:[0,50,100,500]});